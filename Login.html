<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>慈善亭 | 法會報名總覽</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
  <link rel="stylesheet" href="./src/css/overview.css" />


  
  <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet" />
  <script src="./dist/vuefire.js"></script>
</head>

<body>
  <div>
    <section id="admin-wrapper">
      <div id="form-wrapper">
        <h1 class="page-title">慈善亭</h1>
      </div>
    <div id="app"></div>

    </section>
  </div>
  <script type="text/x-template" id="app-template">
      <v-app id="inspire" justify="center">
        <template>
          <v-form >
            <v-container fluid>
              <v-row>
                <v-col
                  cols="12"
                  sm="6"
                >
                  <v-text-field
                    v-model="password"
                    :append-icon="show1 ? 'mdi-eye' : 'mdi-eye-off'"
                    :rules="[rules.required, rules.min]"
                    :type="show1 ? 'text' : 'password'"
                    name="input-10-1"
                    label="請輸入密碼"
                    hint="At least 8 characters"
                    counter
                    @click:append="show1 = !show1"
                  ></v-text-field>
                  <v-btn 
                  @click="login"
                  elevation="2"
                >登入</v-btn>
                </v-col>
              </v-row>
            </v-container>
          </v-form>
        </template>
     
      </v-app>
    </script>
  <script>

    const App = {
      template: "#app-template",
      data() {
        return {
          show1: false,
          password: '',
          rules: {
            required: value => !!value || 'Required.',
            min: v => v.length >= 8 || 'Min 8 characters',
            emailMatch: () => (`The email and password you entered don't match`),
          },
        }
      },
      
      methods: {
        login: function () {
          let self = this;
          this.hash(this.password)
            .then((hex) => {
              if (hex == 'ef51306214d9a6361ee1d5b452e6d2bb70dc7ebb85bf9e02c3d4747fb57d6bec') {
                var date = new Date();
                date.setDate(date.getDate() + 1);
                localStorage.setItem('temple_login_expire_time', date);
                let page = localStorage.getItem('temple_page');
                if ( page == null){
                  page = MemberOverview.html;
                }
                window.location.href = localStorage.getItem('temple_page');
              }
              else {
                alert("密碼錯誤")
              }
            });
        },
        hash(string) {
          const utf8 = new TextEncoder().encode(string);
          return crypto.subtle.digest('SHA-256', utf8).then((hashBuffer) => {
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray
              .map((bytes) => bytes.toString(16).padStart(2, '0'))
              .join('');
            return hashHex;
          });
        }
      },
    };
    new Vue({
      vuetify: new Vuetify(),
      render: (h) => h(App),
    }).$mount("#app");
  </script>
</body>

</html>